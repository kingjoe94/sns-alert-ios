# SNS制限アプリ 仕様（確定）

## 概要
iOSアプリ。
Screen Time を利用して、SNSアプリの使用時間を制限する。
バイブコーディング前提のため、本ファイルが唯一の仕様ソースとする。

---

## 基本ルール
- 制限は **日次**
- 日付の区切りは **ユーザーが設定できるリセット時刻**
- アプリごとに制限時間を管理する
- 制限時間に到達した **アプリのみ** 当日中ブロックする

---

## 監視ONの定義
監視ONとは以下すべてを満たす状態：
- 使用時間の取得を行う
- 制限到達時にアプリをブロックする
- 管理アプリが終了していてもバックグラウンドで有効

---

## Screen Time と管理アプリの責務
### Screen Time / ManagedSettings
- 使用時間の計測
- 制限判定
- アプリのブロック／解除

### 管理アプリ
- 設定UI
- 状態表示
- Screen Time との同期
- リセット時刻の管理
- 使用時間・残り時間の計算表示

---

## 使用時間の扱い
- Screen Time から取得した使用時間を **1分ごとに同期**
- 表示は **アプリ側で計算した値を正**
- 丸めは **1分単位で切り捨て**
- 制限超過は検知した瞬間に即ブロック

---

## 残り時間の表示更新

### 更新タイミング
- 監視開始時：即時に同期を要求して表示を初期化
- フォアグラウンド中：1分ごとに同期して更新
- バックグラウンド復帰時：即時同期して更新
- リセット時刻通過時：即時リセットして再表示

### 計算方法
- 残り分 = max(制限分 - 使用分, 0)
- 表示形式は `X時間Y分`
- 使用時間の丸めは「分単位切り捨て」を適用した値を使う

### 同期失敗時の表示
- 使用時間同期に失敗した場合は前回の使用時間/残り時間を保持
- 画面には簡易エラーメッセージのみ表示
- 次回同期成功時に通常表示へ復帰

---

## リセット仕様
- 初期リセット時刻：0:00
- ユーザーが後から変更可能
- リセット時刻変更は **即時反映**
- リセット時：
  - 全アプリの使用時間をリセット
  - ブロックを全解除
- リセット処理は **バックグラウンドでも自動実行**

---

## 設定編集ルール
- 監視停止中のみ編集可能
- 監視中は閲覧のみ（変更不可）
- 設定変更は次回監視開始時に反映

---

## 初回セットアップ
必須項目：
- Screen Time 権限許可
- 監視対象アプリ選択
- 制限時間設定

セットアップ完了条件：
- 「監視開始」ボタンを押した時点

---

## 画面仕様
- セットアップ完了後は **設定内容一覧画面**を表示
- 残り時間は **詳細画面でのみ表示**
- 表示形式：時間＋分（例：0時間12分）
- アプリ状態はアイコンや色で視覚的に表示

---

## ブロック画面
- iOS標準画面＋自作メッセージ画面を使用
- 表示内容：ブロック理由
- 操作：閉じるだけのボタン（解除不可）

---

## 監視停止
- いつでも停止可能
- 停止しても当日の使用時間は保持
- 同日に再開した場合は残り時間から再開

---

## エラー時の方針
- エラー時は制限をかけない（ユーザー優先）
- 画面には簡単なメッセージのみ表示
- 使用時間が取得できない場合は前回値を表示し続ける

---

## データ保存
- 保存先：端末ローカルのみ
- バックアップ復元は想定しない（新規扱い）

---

## デバッグ（DEBUG限定）
- 使用時間の即リセット
- 即ブロック／即解除トグル

---

## 禁止事項
- 本仕様の変更
- 勝手なUX追加
- 大規模リファクタ
- 仕様の解釈変更
